<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fixtures — High Peak & Marple Snooker League</title>
  <link rel="icon" type="image/png" href="/logo.PNG" sizes="192x192">
  <link rel="apple-touch-icon" href="/logo.PNG">
  <link rel="preload" as="image" href="/logo.PNG">
  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --brand-green:#002b19;
      --accent:#19d36b;
      --bar-dark:#1f1f1f;
      --bar-border:#2a2a2a;
      --overlay-bg:rgba(15,17,22,.85);
      --page-max:1100px;
    }

    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f7f8fb;
      color:#0b1220;
      margin:0;
    }

    header.logo-header{
      background:var(--brand-green);
      height:140px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 2px 10px rgba(0,0,0,.25);
    }
    .logo-banner img{height:100%;width:auto;object-fit:contain;display:block;}

    .menu-bar{background:var(--bar-dark);border-bottom:1px solid var(--bar-border);padding:8px 0}
    .menu-inner{max-width:var(--page-max);margin:0 auto;padding:0 12px;position:relative;}
    .menu-toggle{
      width:100%;background:var(--bar-dark);color:#fff;padding:10px 12px;border:1px solid var(--bar-border);
      border-radius:10px;font-weight:800;font-size:1rem;cursor:pointer;
    }
    nav.site-nav{
      position:absolute;left:12px;right:12px;top:calc(100% + 6px);
      background:var(--overlay-bg);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);
      border-radius:10px;box-shadow:0 18px 36px rgba(0,0,0,.45);padding:6px;z-index:120;
    }
    [hidden]{display:none!important;}
    nav.site-nav a{display:block;color:#e5e7eb;text-decoration:none;font-weight:700;padding:10px;border-radius:8px;}
    nav.site-nav a:hover{background:rgba(255,255,255,.1);}
    nav.site-nav a.active{background:var(--accent);color:#0b1b0f;}

    main.container{
      max-width:var(--page-max);
      background:#fff;
      margin:10px auto;
      padding:1rem 1rem 1.5rem;
      border-radius:10px;
      box-shadow:0 1px 2px rgba(0,0,0,.06);
    }

    .fixture-day{margin:24px 0;}
    .fixture-date{
      font-weight:800;color:#0f172a;font-size:1.05rem;
      padding-bottom:6px;border-bottom:2px solid var(--accent);margin-bottom:10px;
    }

    table.fixtures{width:100%;border-collapse:collapse;}
    .fixtures th,.fixtures td{
      padding:.55rem .75rem;
      border-bottom:1px solid #e9e9e9;
      text-align:left;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .fixtures thead th{background:#eef1f5;color:#0f172a;font-weight:700;font-size:.95rem;}
    .fixtures tbody tr:nth-child(even){background:#fafafa;}
    .fixtures tbody tr:hover{background:#f1f7ff;}

    .badge{font-size:.75rem;font-weight:800;border-radius:999px;padding:.15rem .5rem;}
    .badge.upcoming{background:#e7fbe7;color:#056b2c;border:1px solid #9ae6b4;}
    .badge.past{background:#fff7e6;color:#5a2a00;border:1px solid #ffd38a;}

    .controls{margin:.5rem 0 1rem;font-weight:600;}
  </style>
</head>

<body>

<header class="logo-header">
  <div class="logo-banner">
    <img src="logo.PNG" alt="High Peak & Marple Snooker League crest">
  </div>
</header>

<div class="menu-bar">
  <div class="menu-inner">
    <button class="menu-toggle" id="menuToggle" aria-expanded="false" aria-controls="siteNav">☰ Menu</button>
    <nav id="siteNav" class="site-nav" hidden>
      <a href="index.html">Home</a>
      <a href="fixtures.html" class="active">Fixtures</a>
      <a href="results.html">Results</a>
      <a href="merit.html">Merit</a>
      <a href="venues.html">Venues</a>
      <a href="rules.html">Rules</a>
      <a href="history.html">Honours</a>
      <a href="archive.html">Archive</a>
    </nav>
  </div>
</div>

<main class="container">
  <h2>Fixtures</h2>
  <p>Completed fixtures are hidden automatically once results are posted. Tick below to show past matches.</p>
  <div class="controls"><label><input type="checkbox" id="showPast"> Show past fixtures</label></div>
  <div id="fixtures">Loading fixtures…</div>
</main>

<footer style="text-align:center;padding:1rem;color:#777;">© 2025 High Peak & Marple Snooker League</footer>

<script>
(function(){
  const btn=document.getElementById('menuToggle');
  const nav=document.getElementById('siteNav');
  btn.addEventListener('click',()=>{
    const exp=btn.getAttribute('aria-expanded')==='true';
    btn.setAttribute('aria-expanded',String(!exp));
    nav.hidden=exp;
  });
  document.addEventListener('click',e=>{
    if(!nav.hidden && !nav.contains(e.target) && e.target!==btn){nav.hidden=true;btn.setAttribute('aria-expanded','false');}
  });
})();
</script>

<script>
(async function(){
  const [fixtures, results, teams] = await Promise.all([
    fetch('data/fixtures.json').then(r=>r.json()),
    fetch('data/results.json').then(r=>r.json()).catch(()=>[]),
    fetch('data/teams.json').then(r=>r.json())
  ]);

  // --- Canonical team IDs
  const idMap = {}, nameMap = {};
  teams.forEach(t=>{
    idMap[t.id] = t.name.trim().toLowerCase();
    nameMap[t.name.trim().toLowerCase()] = t.id;
  });

  // --- Name aliases
  const ALIAS = {
    'denton lc':'denton-lib',
    'hayfield 1':'hayfield-1',
    'hayfield 2':'hayfield-2',
    'whaley 1':'whaley-1',
    'whaley 2':'whaley-2',
    'tintwistle 1':'tintwistle1',
    'tintwistle 2':'tintwistle2',
    'alex ashton':'alexashton',
    'alexashton':'alexashton',
    'marple':'marple',
    'chinley':'chinley'
  };

  const getTeamId = (name)=>{
    const key=name.trim().toLowerCase();
    return ALIAS[key] || nameMap[key] || key.replace(/\s+/g,'-');
  };

  // --- Index results by date + team IDs
  const resultKey=(d,h,a)=>`${d}|${h}|${a}`;
  const resultSet = new Set(results.map(r=>resultKey(r.date.trim(),r.homeTeamId,r.awayTeamId)));

  // --- Prepare fixtures
  const allFixtures = fixtures.map(f=>{
    const homeId=getTeamId(f.home);
    const awayId=getTeamId(f.away);
    const key=resultKey(f.date.trim(),homeId,awayId);
    const completed=resultSet.has(key);
    return {...f,completed,dateObj:new Date(f.date)};
  });

  // --- Sort by date
  allFixtures.sort((a,b)=>a.dateObj-b.dateObj);

  const grouped={};
  allFixtures.forEach(f=>{
    (grouped[f.date] ||= []).push(f);
  });

  const container=document.getElementById('fixtures');
  const toggle=document.getElementById('showPast');

  function render(){
    const showPast=toggle.checked;
    container.innerHTML='';
    const dates=Object.keys(grouped).sort((a,b)=>new Date(a)-new Date(b));
    let shown=0;

    for(const d of dates){
      const games=grouped[d];
      const allDone=games.every(g=>g.completed);
      if(!showPast && allDone) continue;

      const section=document.createElement('section');
      section.className='fixture-day';
      section.innerHTML=`<h3 class="fixture-date">${new Date(d).toLocaleDateString('en-GB',{weekday:'short',day:'2-digit',month:'short',year:'numeric'})}</h3>`;

      const table=document.createElement('table');
      table.className='fixtures';
      table.innerHTML='<thead><tr><th>Home</th><th>Away</th><th>Status</th></tr></thead>';
      const tbody=document.createElement('tbody');

      games.forEach(g=>{
        if(!showPast && g.completed) return;
        const badge=g.completed
          ? '<span class="badge past">Completed</span>'
          : '<span class="badge upcoming">Upcoming</span>';
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${g.home}</td><td>${g.away}</td><td>${badge}</td>`;
        tbody.appendChild(tr);
      });

      if(!tbody.children.length) continue;
      table.appendChild(tbody);
      section.appendChild(table);
      container.appendChild(section);
      shown++;
    }

    if(shown===0) container.innerHTML='<p style="color:#555;">No upcoming fixtures — all completed fixtures are hidden.</p>';
  }

  render();
  toggle.addEventListener('change',render);
})();
</script>

</body>
</html>
